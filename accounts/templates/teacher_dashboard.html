{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ teacher.name }} - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/teacher_theme.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Sidebar -->
    {% include 'sidebar_teacher.html' %}

    <!-- Main Content -->
    <div class="main-content">
        <!-- Left Section -->
        <div class="left-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                    <h1 style="font-size: 2rem; margin-bottom: 0.5rem; font-weight: 700;">Welcome, {{ teacher.name }}
                    </h1>
                    <p style="color: var(--text-light);">Faculty Dashboard</p>
                </div>
                <!-- Action Buttons -->
                <div style="display: flex; gap: 10px;">
                    <a href="{% url 'mark_attendance' %}" class="btn-primary" style="text-decoration: none;">
                        <i class="fas fa-camera"></i> Mark Attendance
                    </a>
                </div>
            </div>

            {% if messages %}
            <div style="margin-bottom: 2rem;">
                {% for message in messages %}
                <div
                    style="padding: 1rem; border-radius: 12px; margin-bottom: 0.5rem; background: {% if message.tags == 'error' %}#fee2e2; color: #dc2626; border: 1px solid #fecaca;{% else %}#dcfce7; color: #16a34a; border: 1px solid #bbf7d0;{% endif %} font-weight: 500; display: flex; align-items: center; gap: 10px;">
                    <i
                        class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %}"></i>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Timetable Section -->
            <div class="lessons-section">
                <div class="section-header">
                    <h2 style="font-size: 1.25rem;"><i class="far fa-calendar-alt"
                            style="margin-right: 10px; color: var(--primary-blue);"></i> Weekly Schedule</h2>
                    <span class="badge badge-light">Current Week</span>
                </div>

                <!-- Active Session Banner -->
                {% if active_session %}
                <div class="card"
                    style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; margin-bottom: 2rem; border-left: none; padding: 1.5rem; border-radius: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: white;"><i
                                    class="fas fa-broadcast-tower"></i>
                                Class in Progress</h2>
                            <p style="opacity: 0.9;">{{ active_session.timetable.subject }} â€¢ Started {{active_session.start_time|time:"h:i A" }}</p>
                        </div>
                        <a href="{% url 'live_class_monitoring' %}"
                            style="background: white; color: var(--primary-color); border: none; padding: 10px 20px; text-decoration: none; border-radius: 8px; font-weight: 600;">
                            <i class="fas fa-video"></i> Return to Class
                        </a>
                    </div>
                </div>
                {% endif %}

                {% if grouped_schedule %}
                <!-- Day Navigation Tabs -->
                <div class="schedule-tabs"
                    style="display: flex; gap: 10px; margin-bottom: 2rem; overflow-x: auto; padding-bottom: 5px; border-bottom: 1px solid #e2e8f0;">
                    {% for day, slots in grouped_schedule.items %}
                    <button class="tab-btn {% if forloop.first %}active{% endif %}"
                        onclick="openDay(event, '{{ day }}')"
                        style="padding: 10px 20px; border: none; background: none; font-weight: 600; color: var(--text-light); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; white-space: nowrap;">
                        {{ day }}
                    </button>
                    {% endfor %}
                </div>

                {% for day, slots in grouped_schedule.items %}
                <div id="{{ day }}" class="schedule-content"
                    style="display: {% if forloop.first %}block{% else %}none{% endif %}; animation: fadeIn 0.4s ease;">
                    <div style="margin-bottom: 2rem;">
                        <table class="lessons-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Subject</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for slot in slots %}
                                <tr>
                                    <td>{{ slot.start_time|time:"h:i A" }} - {{ slot.end_time|time:"h:i A" }}</td>
                                    <td>
                                        <span class="badge badge-blue">
                                            {{ slot.subject }}
                                        </span>
                                    </td>
                                    <td>
                                        <span style="color: var(--text-light); font-size: 0.9rem;">Scheduled</span>
                                    </td>
                                    <td>
                                        {% if not active_session %}
                                        <a href="{% url 'start_class' slot.id %}"
                                            style="background: #4caf50; color: white; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 600;">
                                            Start Class
                                        </a>
                                        {% else %}
                                        <span style="color: var(--text-light); font-size: 0.85rem;">Session
                                            Active</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endfor %}

                <script>
                    function openDay(evt, dayName) {
                        var i, tabcontent, tablinks;

                        // Hide all tab content
                        tabcontent = document.getElementsByClassName("schedule-content");
                        for (i = 0; i < tabcontent.length; i++) {
                            tabcontent[i].style.display = "none";
                        }

                        // Remove active class from all tabs
                        tablinks = document.getElementsByClassName("tab-btn");
                        for (i = 0; i < tablinks.length; i++) {
                            tablinks[i].style.color = "var(--text-light)";
                            tablinks[i].style.borderBottom = "3px solid transparent";
                        }

                        // Show the current tab, and add an "active" class to the button that opened the tab
                        document.getElementById(dayName).style.display = "block";
                        evt.currentTarget.style.color = "var(--primary-blue)";
                        evt.currentTarget.style.borderBottom = "3px solid var(--primary-blue)";
                    }

                    // Initial styling for active tab (since inline styles override class)
                    document.addEventListener("DOMContentLoaded", function () {
                        let activeBtn = document.querySelector('.tab-btn.active');
                        if (activeBtn) {
                            activeBtn.style.color = "var(--primary-blue)";
                            activeBtn.style.borderBottom = "3px solid var(--primary-blue)";
                        }
                    });
                </script>

                <style>
                    @keyframes fadeIn {
                        from {
                            opacity: 0;
                            transform: translateY(10px);
                        }

                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                </style>
                {% else %}
                <div style="text-align: center; padding: 4rem; color: var(--text-light);">
                    <i class="far fa-calendar-times" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <p>No classes have been scheduled for you yet.</p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">Contact your Principal to set up your timetable.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Section -->
        <div class="right-section">
            <!-- User Profile Card -->
            <div class="user-profile-card">
                <div class="user-avatar">
                    <img src="https://ui-avatars.com/api/?name={{ teacher.name }}&background=7b92d4&color=fff&size=120&font-size=0.45"
                        alt="{{ teacher.name }}">
                </div>
                <h3>{{ teacher.name }}</h3>
                <p class="role-tag">Teacher</p>
                <a href="{% url 'teacher_profile' %}" class="btn-profile"
                    style="text-decoration: none; display: inline-block;">View Profile</a>
            </div>

            <!-- Calendar -->
            <div class="calendar-card">
                <div class="calendar-header">
                    <h3>{% now "F Y" %}</h3>
                    <div class="calendar-nav">
                        <button><i class="fas fa-chevron-left"></i></button>
                        <button><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-label">Mon</div>
                    <div class="calendar-day-label">Tue</div>
                    <div class="calendar-day-label">Wed</div>
                    <div class="calendar-day-label">Thu</div>
                    <div class="calendar-day-label">Fri</div>
                    <div class="calendar-day-label">Sat</div>
                    <div class="calendar-day-label">Sun</div>

                    <!-- Sample calendar days - you can make this dynamic with Django -->
                    <div class="calendar-day inactive">27</div>
                    <div class="calendar-day inactive">28</div>
                    <div class="calendar-day active">29</div>
                    <div class="calendar-day inactive">30</div>
                    <div class="calendar-day">1</div>
                    <div class="calendar-day">2</div>
                    <div class="calendar-day">3</div>
                    <div class="calendar-day">4</div>
                    <div class="calendar-day">5</div>
                    <div class="calendar-day">6</div>
                    <div class="calendar-day today">7</div>
                    <div class="calendar-day">8</div>
                    <div class="calendar-day">9</div>
                    <div class="calendar-day">10</div>
                    <div class="calendar-day">11</div>
                    <div class="calendar-day">12</div>
                    <div class="calendar-day">13</div>
                    <div class="calendar-day">14</div>
                    <div class="calendar-day">15</div>
                    <div class="calendar-day">16</div>
                    <div class="calendar-day">17</div>
                    <div class="calendar-day">18</div>
                    <div class="calendar-day active">19</div>
                    <div class="calendar-day">20</div>
                    <div class="calendar-day">21</div>
                    <div class="calendar-day">22</div>
                    <div class="calendar-day">23</div>
                    <div class="calendar-day">24</div>
                    <div class="calendar-day">25</div>
                    <div class="calendar-day">26</div>
                    <div class="calendar-day">27</div>
                    <div class="calendar-day active">29</div>
                    <div class="calendar-day">30</div>
                    <div class="calendar-day">31</div>
                </div>
            </div>

            <!-- Reminders -->
            <div class="reminders-card">
                <h3>Reminders</h3>
                <div class="reminder-item">
                    <div class="reminder-icon"><i class="fas fa-bell"></i></div>
                    <div class="reminder-content">
                        <h4>Class - Assessment Review</h4>
                        <p>{% now "d M Y, l" %}</p>
                    </div>
                </div>
                <div class="reminder-item">
                    <div class="reminder-icon"><i class="fas fa-bell"></i></div>
                    <div class="reminder-content">
                        <h4>Staff Meeting</h4>
                        <p>{% now "d M Y, l" %}</p>
                    </div>
                </div>
                <div class="reminder-item">
                    <div class="reminder-icon"><i class="fas fa-bell"></i></div>
                    <div class="reminder-content">
                        <h4>Attendance Report Due</h4>
                        <p>{% now "d M Y, l" %}</p>
                    </div>
                </div>
            </div>

            <!-- Help Widget -->
            <a href="{% url 'teacher_help' %}" style="text-decoration: none; color: inherit;">
                <div class="help-widget">
                    <div class="help-illustration">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3>Need help?</h3>
                    <p>Do you have any problem while using the platform?</p>
                </div>
            </a>
        </div>
    </div>
</body>

</html>